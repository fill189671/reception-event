# reception-event
online-only主催イベントの受付bot（Discord）  
新規サーバー参加者ごとに名札（役職）をつけ、参加する卓を案内する。

## 前提となるDiscordの構造と設定（関係するところのみ抜粋）
* 受付（テキストチャンネル）（役職なしのみ書き込み可能、役職ある人は閲覧のみ可能）
* 卓カテゴリ（各卓の役職のみ書き込み可能、他参加者は閲覧のみ可能）
* ├ アンダーワーク（テキストチャンネル）
* └ 雑談（テキストチャンネル）

## 動作の流れ（ざっくり）
1. 参加者が来たら名前を訊く
2. 名簿と一致したら、参加卓の名札を渡し、卓の場所を案内する

## 動作の流れ（もうちょっと詳しく）
1. 誰かがサーバーに参加したら（25行目）
2. チャンネルを取得し（26・27行目）
3. 案内メンションを送信（28行目）
4. 何かメッセージが送信された時（31行目以降）
5. それが受付チャンネルなら（33行目）
6. 全卓分の（34行目）
7. 参加者名簿と照合し、一致する名前があったら（35行目）
8. 参加卓の役職を取得・付与し（これで参加卓のアンダーワークに書き込めるようになる）（36・38行目）
9. 受付完了のメッセージとアンダーワークチャンネルの案内をメンションする（37行目）

7-1. メッセージと参加者名簿が一致しない場合（40行目）  
7-2. もう一度入力してもらうようメンションする（41行目）

5-1. 受付チャンネル以外での発言には何もしない

## 環境変数
herokuのSetting→ConfigVarsから設定。
* DISCORD_BOT_TOKEN：botトークン（str）　取得方法は「Discord bot　作り方」あたりでググって
* DISCORD_CH_ID：受付チャンネルのID（int、サーバー管理者のみ取得可能）
* EVENT_TABLE：卓リスト（リスト型、次項で説明）
* TABLE_X：各卓情報（辞書型、次項で説明）

## 卓一覧（環境変数）
EVENT_TABLE = [TABLE_X, ... ,TABLE_C,TABLE_B,TABLE_A] という感じで、卓情報をリスト化。卓が増えたらTABLE_Xの部分を増やしていく。  
TABLE_X = {'name':'X卓','rl':'RL名','mem':['参加者','参加者','参加者'],'uw_ch':アンダーワークID（int）,'za_ch':雑談ID（int）} これが一卓分。
* name：卓名 兼 PLに付与する役職名
* rl：RL名
* mem：参加者名簿（リスト型。「参加者」の部分に名前やTwitterアカウントを入れる）
* uw_id：該当卓のアンダーワークチャンネルのID（int）（クォーテーションで囲まない。例：'uw_ch':000000000000000000,'za_ch':...）
* za_id：該当卓の雑談チャンネルのID（int）
